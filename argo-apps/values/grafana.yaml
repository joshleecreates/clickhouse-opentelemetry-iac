env:
  - name: CLICKHOUSE_USERNAME
    valueFrom:
      secretKeyRef:
        name: clickhouse-credentials
        key: user
  - name: CLICKHOUSE_PASSWORD
    valueFrom:
      secretKeyRef:
        name: clickhouse-credentials
        key: password
          
plugins:
  - grafana-clickhouse-datasource
datasources:
  datasources.yaml:
    apiVersion: 1
    datasources:
      - name: ClickHouse
        uid: cluster-clickhouse
        type: clickhouse
        jsonData:
          defaultDatabase: database
          port: 9000
          host: clickhouse-eks.clickhouse.svc.cluster.local
          username: '${env:CLICKHOUSE_USERNAME}'
          tlsSkipVerify: false
        secureJsonData:
          password: '${env:CLICKHOUSE_PASSWORD}'

