image:
  repository: otel/opentelemetry-collector-contrib

mode: daemonset

presets:
  # enables the k8sattributesprocessor and adds it to the traces, metrics, and logs pipelines
  kubernetesAttributes:
    enabled: true
  # enables the kubeletstatsreceiver and adds it to the metrics pipelines
  kubeletMetrics:
    enabled: true
  # Enables the filelogreceiver and adds it to the logs pipelines
  logsCollection:
    enabled: true

env:
  - name: CLICKHOUSE_USERNAME
    valueFrom:
      secretKeyRef:
        name: clickhouse-credentials
        key: user
  - name: CLICKHOUSE_PASSWORD
    valueFrom:
      secretKeyRef:
        name: clickhouse-credentials
        key: password
config:
  exporters:
    clickhouse:
      endpoint: clickhouse://clickhouse-eks.clickhouse.svc.cluster.local:9000?dial_timeout=10s&compress=lz4
      database: otel
      username: '${env:CLICKHOUSE_USERNAME}'
      password: '${env:CLICKHOUSE_PASSWORD}'
      create_schema: true
      logs_table_name: otel_logs
      traces_table_name: otel_traces
      metrics_table_name: otel_metrics
      timeout: 5s
      cluster_name: dev
      retry_on_failure:
        enabled: true
        initial_interval: 5s
        max_interval: 30s
        max_elapsed_time: 300s
  service:
    pipelines:
      metrics:
        exporters: [clickhouse]
      logs:
        exporters: [clickhouse]
      traces:
        exporters: [clickhouse]
